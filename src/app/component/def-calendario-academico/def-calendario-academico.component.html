<mat-tab-group [(selectedIndex)]="activetab">
  <mat-tab label="{{ 'calendario.definicion' | translate }}">
    <mat-card>
      <mat-card-content>
        <div>
          <form novalidate [formGroup]="calendarForm" #fform="ngForm" (ngSubmit)="createCalendar($event)"
            class="form-horizontal">
            <div class="form-grid2">
              <div class="form-col1">
                <mat-form-field style="width: 100%" floatLabel="always">
                  <mat-label>*{{ "calendario.para" | translate }} </mat-label>
                  <mat-select formControlName="Nivel" placeholder="Pregrado/Posgrado" required [disabled]="view"
                    [(ngModel)]="nivelSeleccionado"
                    (selectionChange)="cambiarSelectPeriodoSegunNivel(nivelSeleccionado)">
                    <mat-option>--Seleccionar--</mat-option>
                    <mat-option *ngFor="let nivel of niveles" [value]="nivel.Id">
                      {{ nivel.Nombre }}
                    </mat-option>
                  </mat-select>
                  <mat-error *ngIf="
                      calendarForm.get('Nivel').hasError('required') &&
                      calendarForm.get('Nivel').touched
                    ">
                    {{ "calendario.error_select_para" | translate }}
                  </mat-error>
                </mat-form-field>
              </div>
              <div class="form-col1">
                <mat-form-field style="width: 100%" floatLabel="always">
                  <mat-label>*{{ "calendario.periodo" | translate }}:
                  </mat-label>
                  <mat-select *ngIf="!selectMultipleNivel" formControlName="PeriodoId"
                    placeholder="2020-I, 2020-II, 2020-III" required [disabled]="view">
                    <mat-option value="" disabled>--Seleccionar--</mat-option>
                    <mat-option *ngFor="let periodo of periodos" [value]="periodo.Id">
                      {{ periodo.Nombre }}
                    </mat-option>
                  </mat-select>
                  <mat-select *ngIf="selectMultipleNivel" formControlName="PeriodoId"
                    placeholder="2020-I, 2020-II, 2020-III" required [disabled]="view" multiple>
                    <mat-option *ngFor="let periodo of periodos" [value]="periodo.Id">
                      {{ periodo.Nombre }}
                    </mat-option>
                  </mat-select>

                  <mat-error *ngIf="
                      calendarForm.get('PeriodoId').hasError('required') &&
                      calendarForm.get('PeriodoId').touched
                    ">
                    {{ "calendario.error_select_periodo" | translate }}
                  </mat-error>
                </mat-form-field>
              </div>
            </div>
            <div class="container-bottons" *ngIf="!view">
              <button mat-flat-button color="accent" type="button" (click)="addPeriod()" [disabled]="view">
                {{ "calendario.agregar_periodo" | translate }}
              </button>
            </div>
            <!-- anidado -->

            <mat-card class="margin-y">
              <mat-card-header>
                <mat-card-title>
                  {{ "calendario.resolucion" | translate }}
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <div class="form-grid2">
                  <div class="form-col1">
                    <mat-form-field class="form-field">
                      <input matInput type="number" formControlName="resolucion" placeholder="{{
                          'calendario.numero_resolucion' | translate
                        }} " required />
                      <mat-error *ngIf="
                          calendarForm.get('resolucion').hasError('required') &&
                          calendarForm.get('resolucion').touched
                        ">
                        {{ "calendario.error_resolucion" | translate }}
                      </mat-error>
                    </mat-form-field>
                  </div>
                  <div class="form-col1">
                    <mat-form-field class="form-field">
                      <input matInput type="text" formControlName="anno" minlength="4" maxlength="4" pattern="^[0-9]*$"
                        placeholder="{{
                          'calendario.anno_resolucion' | translate
                        }} " required />
                      <mat-error *ngIf="
                          calendarForm.get('anno').hasError('required') &&
                          calendarForm.get('anno').touched &&
                          calendarForm.get('anno').hasError('pattern')
                        ">
                        {{ "calendario.error_anno" | translate }}
                      </mat-error>
                    </mat-form-field>
                  </div>
                </div>
                <div class="col-2" *ngIf="!view">
                  <p>{{ "calendario.etiqueta_documento" | translate }}</p>
                </div>
                <div class="margin-y">
                  <div *ngIf="uploadMode">
                    <button mat-flat-button color="accent" type="button" (click)="fileInput.click()"
                      title="{{ 'calendario.subir_resolucion' | translate }}">
                      <mat-icon fontIcon="attach_file"></mat-icon>
                      <input formControlName="fileResolucion" #fileInput type="file"
                        (change)="onInputFileResolucion($event)" style="display: none" accept="application/pdf"
                        data-max-size="5120" />
                    </button>
                    <mat-error *ngIf="!fileResolucion">{{
                      "ERROR.no_documento" | translate
                      }}</mat-error>
                    <label style="margin-left: 1em" *ngIf="fileResolucion">{{ "GLOBAL.archivo_seleccionado" | translate
                      }}:
                      {{ fileResolucion.file.name }}</label>
                  </div>
                  <div *ngIf="editMode">
                    <button mat-flat-button color="accent" type="button" (click)="downloadFile(calendar.DocumentoId)"
                      title="{{
                        'calendario.descargar_resolucion' | translate
                      }}" *ngIf="!view">
                      <mat-icon fontIcon="cloud_download"></mat-icon>
                    </button>
                  </div>
                </div>
              </mat-card-content>
            </mat-card>
            <!-- //VOLVER  !createdCalendar -->
            <div class="row" *ngIf="!createdCalendar">
              <button mat-flat-button color="accent" type="submit" [disabled]="calendarForm.invalid">
                {{ "GLOBAL.guardar" | translate }}
              </button>
            </div>
          </form>
          <mat-card *ngIf="createdCalendar" class="margin-y">
            <mat-card-header>
              <mat-card-title>
                {{ "calendario.procesos_actividades" | translate }}
              </mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div *ngIf="activebutton">
                <p class="margin-y">
                  {{ "calendario.procesos_descripcion" | translate }}
                </p>
                <div class="container-bottons">
                  <button mat-flat-button color="accent" type="button" (click)="openTabsClone()">
                    {{ "calendario.procesos_copiar" | translate }}
                  </button>
                  <button mat-flat-button color="accent" type="button" (click)="openTabs()">
                    {{ "calendario.procesos_definir" | translate }}
                  </button>
                </div>
              </div>
              <form novalidate [formGroup]="calendarFormClone" #fform="ngForm" *ngIf="activetabsClone">
                <div class="margin-y">
                  <p>
                    {{ "calendario.clonar_calendario_nombre" | translate }}
                  </p>
                  <div class="form-grid2">
                    <div class="form-col1">
                      <mat-form-field style="width: 100%" floatLabel="always">
                        <mat-label>*{{ "calendario.para" | translate }}
                        </mat-label>
                        <mat-select formControlName="NivelClone" placeholder="Pregrado/Posgrado" required>
                          <mat-option>--Seleccionar--</mat-option>
                          <mat-option *ngFor="let nivelClone of niveles" [value]="nivelClone.Id">
                            {{ nivelClone.Nombre }}
                          </mat-option>
                        </mat-select>
                        <mat-error *ngIf="
                            calendarFormClone
                              .get('NivelClone')
                              ?.hasError('required') &&
                            calendarFormClone.get('NivelClone')?.touched
                          ">
                          {{ "calendario.error_select_para" | translate }}
                        </mat-error>
                      </mat-form-field>
                    </div>
                    <div class="form-col1">
                      <mat-form-field style="width: 100%" floatLabel="always">
                        <mat-label>*{{ "calendario.periodo" | translate }}:
                        </mat-label>
                        <mat-select formControlName="PeriodoIdClone" placeholder="2020-I, 2020-II, 2020-III" required>
                          <mat-option>--Seleccionar--</mat-option>
                          <mat-option *ngFor="let periodoClone of periodosClone" [value]="periodoClone.Id">
                            {{ periodoClone.Nombre }}
                          </mat-option>
                        </mat-select>
                        <mat-error *ngIf="
                            calendarFormClone
                              .get('PeriodoIdClone')
                              ?.hasError('required') &&
                            calendarFormClone.get('PeriodoIdClone')?.touched
                          ">
                          {{ "calendario.error_select_periodo" | translate }}
                        </mat-error>
                      </mat-form-field>
                    </div>
                  </div>
                  <div class="form-grid2">
                    <div class="form-col2">
                      <button class="form-field" mat-flat-button color="accent" type="button"
                        (click)="clonarCalendario()">
                        {{ "calendario.clonar_calendario" | translate }}
                      </button>
                    </div>
                  </div>
                </div>
              </form>
              <div *ngIf="activetabs">
                <mat-tab-group>
                  <mat-tab label="{{ 'calendario.procesos' | translate }}">
                    <mat-card>
                      <mat-card-content>
                        <!-- BUSCANDO Y BOTON -->
                        <div style="
                            display: flex;
                            justify-content: space-between;
                            flex-wrap: wrap;
                          ">
                          <div class="" style="
                              display: flex;
                              flex: 1;
                              justify-content: flex-end;
                              margin-right: 1em;
                            ">
                            <mat-form-field class="form-field">
                              <mat-label>{{
                                "GLOBAL.buscar" | translate
                                }}</mat-label>
                              <input matInput type="text" (keyup)="applyFilterProces($event)"
                                placeholder="{{ 'GLOBAL.buscar' | translate }}" #input />
                            </mat-form-field>
                          </div>
                          <div style="
                              display: flex;
                              justify-content: flex-start;
                              align-items: center;
                              margin: 0px 0px;
                              margin-bottom: 1.3em;
                            ">
                            <button mat-flat-button style="height: 100%" color="accent" type="button"
                              (click)="addProcess($event)" *ngIf="!view">
                              <mat-icon style="vertical-align: middle" fontIcon="add">
                              </mat-icon>
                              <label>{{
                                "calendario.tooltip_crear_proceso" | translate
                                }}</label>
                            </button>
                          </div>
                        </div>

                        <!-- TABLA -->
                        <div class="mat-elevation-z8 table" (custom)="onAction($event, null)">
                          <table mat-table [dataSource]="dataSource" matSort>
                            <!-- ID Column -->
                            <ng-container matColumnDef="Nombre" sticky>
                              <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 20%">
                                {{ "calendario.nombre" | translate }}
                              </th>
                              <td mat-cell *matCellDef="let row">
                                {{ row.Nombre }}
                              </td>
                            </ng-container>
                            <!-- Progress Column -->
                            <ng-container matColumnDef="Descripcion">
                              <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 80%">
                                {{ "GLOBAL.descripcion" | translate }}
                              </th>

                              <td mat-cell *matCellDef="let row">
                                {{ row.Descripcion }}
                              </td>
                            </ng-container>

                            <ng-container matColumnDef="Acciones">
                              <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                {{ "GLOBAL.acciones" | translate }}
                              </th>
                              <td mat-cell *matCellDef="let row">
                                <button mat-icon-button color="accent" (click)="editProcess({ data: row })">
                                  <mat-icon aria-hidden="false" title="{{
                                      'calendario.tooltip_detalle_proceso'
                                        | translate
                                    }}" fontIcon="edit"></mat-icon>
                                </button>

                                <button mat-icon-button color="accent" [disabled]="view"
                                  (click)="deleteProcess({ data: row })">
                                  <mat-icon aria-hidden="false" title="{{
                                      'calendario.tooltip_detalle_proceso'
                                        | translate
                                    }}" fontIcon="delete" class="icon">
                                  </mat-icon>
                                </button>
                              </td>
                            </ng-container>

                            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                            <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

                            <!-- Row shown when there is no matching data. -->
                            <tr class="mat-row" *matNoDataRow>
                              <td class="mat-cell" colspan="4">
                                {{ "calendario.sin_procesos" | translate }}
                              </td>
                            </tr>
                          </table>
                        </div>
                      </mat-card-content>
                    </mat-card>
                  </mat-tab>

                  <mat-tab label="{{ 'calendario.actividades' | translate }}">
                    <mat-accordion>
                      <mat-expansion-panel *ngFor="let process of processes; index as i">
                        <mat-expansion-panel-header>
                          <mat-panel-title>
                            {{ process.Nombre }}
                          </mat-panel-title>
                        </mat-expansion-panel-header>
                        <div style="
                            display: grid;
                            grid-template-columns: 1fr 1fr;
                            margin: 20px 0px;
                          ">
                          <div style="
                              display: flex;
                              justify-content: flex-start;
                              margin: 0px 0px;
                            ">
                            <button class="boton-primary" type="button" (click)="addActivity($event, process)"
                              *ngIf="!view">
                              <mat-icon style="vertical-align: middle" fontIcon="add">
                              </mat-icon>
                              <label>{{
                                "calendario.tooltip_crear_actividad" | translate
                                }}</label>
                            </button>
                          </div>

                          <div class="search-container" style="display: flex; justify-content: flex-end">
                            <input matInput (keyup)="
                                applyFilterActividades(
                                  $event,
                                  process.actividades,
                                  i
                                )
                              " placeholder="{{ 'GLOBAL.buscar' | translate }}" #inputActividades />
                            <mat-icon class="icon-search" matPrefix>search</mat-icon>
                          </div>
                        </div>
                        <div class="mat-elevation-z8">
                          <table mat-table [dataSource]="process.actividades" matSort>
                            <!-- ID Column -->
                            <ng-container matColumnDef="Nombre">
                              <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 20%">
                                {{ "calendario.nombre" | translate }}
                              </th>
                              <td mat-cell *matCellDef="let row">
                                {{ row.Nombre }}
                              </td>
                            </ng-container>

                            <!-- Progress Column -->
                            <ng-container matColumnDef="Descripcion">
                              <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 20%">
                                {{ "GLOBAL.descripcion" | translate }}
                              </th>

                              <td mat-cell *matCellDef="let row">
                                {{ row.Descripcion }}
                              </td>
                            </ng-container>

                            <ng-container matColumnDef="FechaInicio">
                              <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 20%">
                                {{ "calendario.fecha_inicio" | translate }}
                              </th>
                              <td mat-cell *matCellDef="let row">
                                {{ row.FechaInicio }}
                              </td>
                            </ng-container>

                            <ng-container matColumnDef="FechaFin">
                              <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 20%">
                                {{ "calendario.fecha_fin" | translate }}
                              </th>
                              <td mat-cell *matCellDef="let row">
                                {{ row.FechaFin }}
                              </td>
                            </ng-container>

                            <ng-container matColumnDef="Activo">
                              <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 20%">
                                {{ "calendario.estado" | translate }}
                              </th>
                              <td mat-cell *matCellDef="let row">
                                {{ row.Activo }}
                              </td>
                            </ng-container>

                            <ng-container matColumnDef="Acciones">
                              <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 20%">
                                {{ "GLOBAL.acciones" | translate }}
                              </th>
                              <td mat-cell *matCellDef="let row">
                                <button (click)="
                                    onAction(
                                      { action: 'edit', data: row },
                                      process.actividades
                                    )
                                  " style="width: 25%; border: none" class="icon" title="{{
                                    'calendario.tooltip_editar_actividad'
                                      | translate
                                  }}" [disabled]="view">
                                  <mat-icon aria-hidden="false" fontIcon="edit_outline"></mat-icon>
                                </button>
                                <button (click)="
                                    onAction(
                                      { action: 'delete', data: row },
                                      process
                                    )
                                  " style="width: 25%; border: none" class="icon" title="{{
                                    'calendario.tooltip_eliminar_actividad'
                                      | translate
                                  }}" [disabled]="view">
                                  <mat-icon aria-hidden="false" fontIcon="delete">
                                  </mat-icon>
                                </button>
                                <button (click)="
                                    onAction(
                                      { action: 'select', data: row },
                                      process.actividades
                                    )
                                  " style="width: 25%; border: none" class="icon" title="{{
                                    'calendario.tooltip_seleccionar_proyectos'
                                      | translate
                                  }}" [disabled]="view">
                                  <mat-icon aria-hidden="false" fontIcon="check">
                                  </mat-icon>
                                </button>
                                <button (click)="
                                    onAction(
                                      { action: 'view', data: row },
                                      process.actividades
                                    )
                                  " style="width: 25%; border: none" class="icon" title="{{
                                    'calendario.tooltip_detalle_actividad'
                                      | translate
                                  }}" [disabled]="view">
                                  <mat-icon aria-hidden="false" fontIcon="search">
                                  </mat-icon>
                                </button>
                              </td>
                            </ng-container>

                            <tr mat-header-row *matHeaderRowDef="displayedColumnsActividades"></tr>
                            <tr mat-row *matRowDef="
                                let row;
                                columns: displayedColumnsActividades
                              "></tr>

                            <!-- Row shown when there is no matching data. -->
                            <tr class="mat-row" *matNoDataRow>
                              <td class="mat-cell" colspan="4">
                                No data matching the filter "{{
                                inputActividades.value
                                }}"
                              </td>
                            </tr>
                          </table>
                        </div>
                      </mat-expansion-panel>
                    </mat-accordion>
                  </mat-tab>
                </mat-tab-group>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-card-content>
    </mat-card>
  </mat-tab>

  <!-- ///////////// No tocar de aqui para arriba ///////////// -->

  <mat-tab label="{{ 'calendario.formulario_extension' | translate }}">
    <mat-card>
      <mat-card-header>
        <mat-card-title>
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <ng-container *ngIf="showList">
          <mat-form-field style="width: 100%" floatLabel="always">
            <mat-label>
              {{ "calendario.seleccione_version_calendario" | translate }}
            </mat-label>
            <mat-select placeholder="{{
                'calendario.seleccione_version_calendario' | translate
              }}" [(value)]="selCalendar">
              <mat-option *ngFor="let Calendar of ExtensionList" (click)="loadExtension(Calendar.Id)"
                [value]="Calendar.Id">
                {{ Calendar.Nombre }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </ng-container>
        <form novalidate [formGroup]="calendarFormExtend" #fform="ngForm" (ngSubmit)="extendCalendar($event)"
          class="form-horizontal">
          <div class="form-grid2">
            <div class="form-col1">
              <mat-form-field style="width: 100%" floatLabel="always">
                <mat-label>*{{ "calendario.para" | translate }} </mat-label>
                <mat-select formControlName="Nivel" placeholder="Pregrado/Posgrado" required [disabled]="view">
                  <mat-option>--Seleccionar--</mat-option>
                  <mat-option *ngFor="let nivel of niveles" [value]="nivel.Id">
                    {{ nivel.Nombre }}
                  </mat-option>
                </mat-select>
                <mat-error *ngIf="
                    calendarFormExtend.get('Nivel').hasError('required') &&
                    calendarFormExtend.get('Nivel').touched
                  ">
                  {{ "calendario.error_select_para" | translate }}
                </mat-error>
              </mat-form-field>
            </div>
            <div class="form-col1">
              <mat-form-field style="width: 100%" floatLabel="always">
                <mat-label>*{{ "calendario.periodo" | translate }}: </mat-label>
                <mat-select *ngIf="!selectMultipleNivel" formControlName="PeriodoId"
                    placeholder="2020-I, 2020-II, 2020-III" required [disabled]="view">
                    <mat-option value="" disabled>--Seleccionar--</mat-option>
                    <mat-option *ngFor="let periodo of periodos" [value]="periodo.Id">
                      {{ periodo.Nombre }}
                    </mat-option>
                  </mat-select>
                  <mat-select *ngIf="selectMultipleNivel" formControlName="PeriodoId"
                    placeholder="2020-I, 2020-II, 2020-III" required [disabled]="view" multiple>
                    <mat-option *ngFor="let periodo of periodos" [value]="periodo.Id">
                      {{ periodo.Nombre }}
                    </mat-option>
                  </mat-select>
                <mat-error *ngIf="
                    calendarFormExtend.get('PeriodoId').hasError('required') &&
                    calendarFormExtend.get('PeriodoId').touched
                  ">
                  {{ "calendario.error_select_periodo" | translate }}
                </mat-error>
              </mat-form-field>
            </div>
          </div>

          <mat-card>
            <mat-card-header>
              <mat-card-title>
                {{ "calendario.resolucion_extension" | translate }}
              </mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="form-grid2">
                <div class="form-col1">
                  <mat-form-field class="form-field">
                    <input matInput type="number" formControlName="resolucion" placeholder="{{
                        'calendario.numero_resolucion' | translate
                      }} " required />
                    <mat-error *ngIf="
                        calendarFormExtend
                          .get('resolucion')
                          .hasError('required') &&
                        calendarFormExtend.get('resolucion').touched
                      ">
                      {{ "calendario.error_resolucion" | translate }}
                    </mat-error>
                  </mat-form-field>
                </div>
                <div class="form-col1">
                  <mat-form-field class="form-field">
                    <input matInput type="text" formControlName="anno" minlength="4" maxlength="4" pattern="^[0-9]*$"
                      placeholder="{{
                        'calendario.anno_resolucion' | translate
                      }} " required />
                    <mat-error *ngIf="
                        calendarFormExtend.get('anno').hasError('required') &&
                        calendarFormExtend.get('anno').touched &&
                        calendarForm.get('anno').hasError('pattern')
                      ">
                      {{ "calendario.error_anno" | translate }}
                    </mat-error>
                  </mat-form-field>
                </div>
              </div>
              <p *ngIf="!view" class="margin-y">
                {{ "calendario.etiqueta_documento" | translate }}
              </p>
              <div *ngIf="!Extension">
                <button mat-flat-button color="accent" type="button" (click)="fileInput.click()"
                  title="{{ 'calendario.subir_resolucion' | translate }}" *ngIf="!view">
                  <mat-icon fontIcon="attach_file"></mat-icon>
                  <input formControlName="fileResolucion" #fileInput type="file"
                    (change)="onInputFileResolucionExt($event)" style="display: none" accept="application/pdf"
                    data-max-size="5120" />
                </button>
                <mat-error *ngIf="
                    calendarFormExtend
                      .get('fileResolucion')
                      .hasError('required')
                  ">{{ "ERROR.no_documento" | translate }}</mat-error>
                <label *ngIf="fileResolucionExt" style="margin-left: 1em">{{ "GLOBAL.archivo_seleccionado" | translate
                  }}:
                  {{ fileResolucionExt.file.name }}</label>
              </div>
              <div *ngIf="Extension">
                <button mat-flat-button color="accent" type="button" (click)="downloadFileExt(fileExtId)"
                  title="{{ 'calendario.descargar_resolucion' | translate }}" *ngIf="!view">
                  <mat-icon fontIcon="cloud_download"></mat-icon>
                </button>
              </div>
            </mat-card-content>
          </mat-card>
          <!-- anidado -->

          <div class="info margin-y">
            {{ "calendario.extension_proyectos_info" | translate }}
          </div>

          <mat-card>
            <mat-card-header>
              <mat-card-title>
                {{ "calendario.programas_curriculares" | translate }}
              </mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <mat-form-field style="width: 100%">
                <mat-label>{{
                  "calendario.seleccione_proyecto" | translate
                  }}</mat-label>
                <mat-select formControlName="selProyectos" [disabled]="
                    calendarFormExtend
                      .get('fileResolucion')
                      .hasError('required') && !Extension
                  " multiple [disabled]="view">
                  <mat-option value="0" disabled>{{
                    "calendario.seleccione_proyecto" | translate
                    }}</mat-option>
                  <mat-option *ngFor="let project of projects" [value]="project.Id">{{ project.Nombre }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </mat-card-content>
          </mat-card>

          <mat-card *ngIf="createdCalendar" class="margin-y">
            <mat-card-header>
              <mat-card-title>
                {{ "calendario.procesos_actividades" | translate }}
              </mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="calendar-content" *ngIf="activetabs">
                <ng-container *ngIf="!Extension && !Ext_Extension">
                  <mat-tab-group>
                    <mat-tab label="{{ 'calendario.procesos' | translate }}">
                      <mat-card>
                        <mat-card-content>
                          <div style="
                              display: flex;
                              flex-wrap: wrap;
                              gap: 1rem;
                              margin-top: 1em;
                            ">
                            <div class="search-container" style="display: flex; flex: 1">
                              <mat-form-field style="width: 100%">
                                <mat-label>{{
                                  "GLOBAL.buscar" | translate
                                  }}</mat-label>
                                <input matInput (keyup)="applyFilterProces($event)" placeholder="{{
                                    'GLOBAL.buscar' | translate
                                  }}" #input />
                              </mat-form-field>
                            </div>
                            <div style="
                                display: flex;
                                margin-bottom: 1.3em;
                              ">
                              <button style="height: 100%" mat-flat-button color="accent" type="button"
                                (click)="addProcess($event)" *ngIf="!view">
                                <mat-icon style="vertical-align: middle" fontIcon="add">
                                </mat-icon>
                                <label>{{
                                  "calendario.tooltip_crear_proceso" | translate
                                  }}</label>
                              </button>
                            </div>
                          </div>

                          <div class="mat-elevation-z8 table" (custom)="onAction($event, null)">
                            <table mat-table [dataSource]="dataSource" class="demo-table" matSort>
                              <!-- ID Column -->
                              <ng-container matColumnDef="Nombre" sticky>
                                <th [style]="{ 'text-align': 'left' }" mat-header-cell *matHeaderCellDef mat-sort-header
                                  style="width: 20%">
                                  {{ "calendario.nombre" | translate }}
                                </th>
                                <td mat-cell *matCellDef="let row">
                                  {{ row.Nombre }}
                                </td>
                              </ng-container>
                              <!-- Progress Column -->
                              <ng-container matColumnDef="Descripcion">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 80%">
                                  {{ "GLOBAL.descripcion" | translate }}
                                </th>

                                <td mat-cell *matCellDef="let row">
                                  {{ row.Descripcion }}
                                </td>
                              </ng-container>

                              <ng-container matColumnDef="Acciones">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                  {{ "GLOBAL.acciones" | translate }}
                                </th>
                                <td mat-cell *matCellDef="let row">
                                  <button mat-icon-button color="accent" (click)="editProcess({ data: row })"
                                    [disabled]="view">
                                    <mat-icon aria-hidden="false" title="{{
                                        'calendario.tooltip_detalle_proceso'
                                          | translate
                                      }}" fontIcon="edit">
                                    </mat-icon>
                                  </button>
                                  <button mat-icon-button color="accent" (click)="
                                      onAction(
                                        { action: 'view', data: row },
                                        null
                                      )
                                    " [disabled]="view">
                                    <mat-icon aria-hidden="false" title="{{
                                        'calendario.tooltip_detalle_proceso'
                                          | translate
                                      }}" fontIcon="delete">
                                    </mat-icon>
                                  </button>
                                </td>
                              </ng-container>

                              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                              <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

                              <!-- Row shown when there is no matching data. -->
                              <tr class="mat-row" *matNoDataRow>
                                <td class="mat-cell" colspan="4">
                                  {{ "calendario.sin_procesos" | translate }}
                                </td>
                              </tr>
                            </table>
                          </div>
                        </mat-card-content>
                      </mat-card>
                    </mat-tab>
                    <mat-tab label="{{ 'calendario.actividades' | translate }}">
                      <mat-accordion>
                        <mat-expansion-panel *ngFor="let process of processes; index as i">
                          <mat-expansion-panel-header>
                            <mat-panel-title>
                              {{ process.Nombre }}
                            </mat-panel-title>
                          </mat-expansion-panel-header>
                          <mat-card class="margin-y">
                            <mat-card-content>
                              <div style="display: flex; flex-wrap: wrap">
                                <div style="
                                    display: flex;
                                    margin-bottom: 1.3 em;
                                    height: 100%;
                                    gap: 1 em;
                                  ">
                                  <button mat-flat-button color="accent" type="button"
                                    (click)="addActivity($event, process)" *ngIf="!view">
                                    <mat-icon style="vertical-align: middle" fontIcon="add">
                                    </mat-icon>
                                    <label>{{
                                      "calendario.tooltip_crear_actividad"
                                      | translate
                                      }}</label>
                                  </button>
                                </div>

                                <div style="display: flex; flex: 1">
                                  <mat-form-field style="width: 100%">
                                    <mat-label>{{
                                      "GLOBAL.buscar" | translate
                                      }}</mat-label>
                                    <input matInput (keyup)="
                                        applyFilterActividades(
                                          $event,
                                          process.actividades,
                                          i
                                        )
                                      " placeholder="{{
                                        'GLOBAL.buscar' | translate
                                      }}" #inputActividades />
                                  </mat-form-field>
                                </div>
                              </div>
                              <div class="mat-elevation-z8 table">
                                <table mat-table [dataSource]="process.actividades" matSort>
                                  <!-- ID Column -->
                                  <ng-container matColumnDef="Nombre">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 20%">
                                      {{ "calendario.nombre" | translate }}
                                    </th>
                                    <td mat-cell *matCellDef="let row">
                                      {{ row.Nombre }}
                                    </td>
                                  </ng-container>

                                  <!-- Progress Column -->
                                  <ng-container matColumnDef="Descripcion">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 20%">
                                      {{ "GLOBAL.descripcion" | translate }}
                                    </th>

                                    <td mat-cell *matCellDef="let row">
                                      {{ row.Descripcion }}
                                    </td>
                                  </ng-container>

                                  <ng-container matColumnDef="FechaInicio">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 20%">
                                      {{
                                      "calendario.fecha_inicio" | translate
                                      }}
                                    </th>
                                    <td mat-cell *matCellDef="let row">
                                      {{ row.FechaInicio }}
                                    </td>
                                  </ng-container>

                                  <ng-container matColumnDef="FechaFin">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 20%">
                                      {{ "calendario.fecha_fin" | translate }}
                                    </th>
                                    <td mat-cell *matCellDef="let row">
                                      {{ row.FechaFin }}
                                    </td>
                                  </ng-container>

                                  <ng-container matColumnDef="Activo">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 20%">
                                      {{ "calendario.estado" | translate }}
                                    </th>
                                    <td mat-cell *matCellDef="let row">
                                      {{ row.Activo }}
                                    </td>
                                  </ng-container>

                                  <ng-container matColumnDef="Acciones">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 20%">
                                      {{ "GLOBAL.acciones" | translate }}
                                    </th>
                                    <td mat-cell *matCellDef="let row">
                                      <button (click)="
                                          onAction(
                                            { action: 'edit', data: row },
                                            process.actividades
                                          )
                                        " mat-icon-button color="accent" title="{{
                                          'calendario.tooltip_editar_actividad'
                                            | translate
                                        }}" [disabled]="view">
                                        <mat-icon aria-hidden="false" fontIcon="edit_outline"></mat-icon>
                                      </button>
                                      <button (click)="onAction( {action: 'disable', }, process )" mat-icon-button
                                        color="warn" title="{{
                                          'calendario.tooltip_eliminar_actividad'
                                            | translate
                                        }}" [disabled]="view">
                                        <mat-icon aria-hidden="false" fontIcon="delete">
                                        </mat-icon>
                                      </button>
                                      <button (click)="
                                          onAction(
                                            { action: 'select', data: row },
                                            process.actividades
                                          )
                                        " mat-icon-button color="accent" title="{{
                                          'calendario.tooltip_seleccionar_proyectos'
                                            | translate
                                        }}" [disabled]="view">
                                        <mat-icon aria-hidden="false" fontIcon="check">
                                        </mat-icon>
                                      </button>
                                      <button (click)="
                                          onAction(
                                            { action: 'view', data: row },
                                            process.actividades
                                          )
                                        " mat-icon-button color="accent" title="{{
                                          'calendario.tooltip_detalle_actividad'
                                            | translate
                                        }}" [disabled]="view">
                                        <mat-icon aria-hidden="false" fontIcon="search">
                                        </mat-icon>
                                      </button>
                                    </td>
                                  </ng-container>

                                  <tr mat-header-row *matHeaderRowDef="
                                      displayedColumnsActividades
                                    "></tr>
                                  <tr mat-row *matRowDef="
                                      let row;
                                      columns: displayedColumnsActividades
                                    "></tr>

                                  <!-- Row shown when there is no matching data. -->
                                  <tr class="mat-row" *matNoDataRow>
                                    <td class="mat-cell" colspan="4">
                                      No data matching the filter "{{
                                      inputActividades.value
                                      }}"
                                    </td>
                                  </tr>
                                </table>
                              </div>
                            </mat-card-content>
                          </mat-card>
                        </mat-expansion-panel>
                      </mat-accordion>
                    </mat-tab>
                  </mat-tab-group>
                </ng-container>

                <!-- AQUI VOY -->
                <ng-container *ngIf="!Extension || Ext_Extension">
                  <mat-tab-group>
                    <mat-tab label="{{ 'calendario.procesos' | translate }}">
                      <mat-card>
                        <mat-card-content>
                          <div style="
                              display: flex;
                              flex-wrap: wrap;
                              gap: 1rem;
                              margin-top: 1em;
                            ">
                            <div class="search-container" style="display: flex; flex: 1">
                              <mat-form-field style="width: 100%">
                                <mat-label>{{
                                  "GLOBAL.buscar" | translate
                                  }}</mat-label>
                                <input matInput (keyup)="applyFilterProces($event)" placeholder="{{
                                    'GLOBAL.buscar' | translate
                                  }}" #input />
                              </mat-form-field>
                            </div>

                            <div style="display: flex; margin-bottom: 1.3 em">
                              <button mat-flat-button color="accent" style="height: 100%" type="button"
                                (click)="addProcess($event)" *ngIf="!view">
                                <mat-icon style="vertical-align: middle" fontIcon="add">
                                </mat-icon>
                                <label>{{
                                  "calendario.tooltip_crear_proceso" | translate
                                  }}</label>
                              </button>
                            </div>
                          </div>

                          <div class="mat-elevation-z8 table" (custom)="onAction($event, null)">
                            <table mat-table [dataSource]="datasourceExtension" class="demo-table" matSort>
                              <!-- ID Column -->
                              <ng-container matColumnDef="Nombre" sticky>
                                <th class="text-left" mat-header-cell *matHeaderCellDef mat-sort-header
                                  style="width: 20%">
                                  {{ "calendario.nombre" | translate }}
                                </th>
                                <td mat-cell *matCellDef="let row">
                                  {{ row.Nombre }}
                                </td>
                              </ng-container>
                              <!-- Progress Column -->
                              <ng-container matColumnDef="Descripcion">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 80%">
                                  {{ "GLOBAL.descripcion" | translate }}
                                </th>

                                <td mat-cell *matCellDef="let row">
                                  {{ row.Descripcion }}
                                </td>
                              </ng-container>

                              <ng-container matColumnDef="Acciones">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                  {{ "GLOBAL.acciones" | translate }}
                                </th>
                                <td mat-cell *matCellDef="let row">
                                  <button mat-icon-button color="accent" (click)="editProcess({ data: row })"
                                    [disabled]="view">
                                    <mat-icon aria-hidden="false" fontIcon="edit">
                                    </mat-icon>
                                  </button>
                                  <button mat-icon-button color="accent" (click)="deleteProcess($event)"
                                    style="border: none" [disabled]="view">
                                    <mat-icon aria-hidden="false" title="{{
                                        'calendario.tooltip_detalle_proceso'
                                          | translate
                                      }}" fontIcon="delete">
                                    </mat-icon>
                                  </button>
                                </td>
                              </ng-container>

                              <tr mat-header-row *matHeaderRowDef="displayedColumnsExtension"></tr>
                              <tr mat-row *matRowDef="
                                  let row;
                                  columns: displayedColumnsExtension
                                "></tr>

                              <!-- Row shown when there is no matching data. -->
                              <tr class="mat-row" *matNoDataRow>
                                <td class="mat-cell" colspan="4">
                                  {{ "calendario.sin_procesos" | translate }}
                                </td>
                              </tr>
                            </table>
                          </div>
                        </mat-card-content>
                      </mat-card>
                    </mat-tab>
                    <mat-tab label="{{ 'calendario.actividades' | translate }}">
                      <mat-accordion>
                        <mat-expansion-panel *ngFor="let process of processesExt; index as i">
                          <mat-expansion-panel-header>
                            <mat-panel-title>
                              {{ process.Nombre }}
                            </mat-panel-title>
                          </mat-expansion-panel-header>

                          <mat-card>
                            <mat-card-content>
                              <div style="
                                  display: flex;
                                  flex-wrap: wrap;
                                  gap: 1 em;
                                  margin-top: 1 rem;
                                ">
                                <div style="display: flex; margin-bottom: 1.3 em" (click)="addActivity($event, process)"
                                  *ngIf="!view">
                                  <button mat-flat-button color="accent" style="height: 100%" type="button">
                                    <mat-icon style="vertical-align: middle" fontIcon="add">
                                    </mat-icon>
                                    <label>{{
                                      "calendario.tooltip_crear_actividad"
                                      | translate
                                      }}</label>
                                  </button>
                                </div>

                                <div style="display: flex; flex: 1">
                                  <mat-form-field style="width: 100%">
                                    <mat-label>{{
                                      "GLOBAL.buscar" | translate
                                      }}</mat-label>
                                    <input matInput (keyup)="
                                        applyFilterActividades(
                                          $event,
                                          process.actividades,
                                          i
                                        )
                                      " placeholder="{{
                                        'GLOBAL.buscar' | translate
                                      }}" #inputActividades />
                                  </mat-form-field>
                                </div>
                              </div>

                              <div class="mat-elevation-z8 table">
                                <table mat-table [dataSource]="process.actividades" matSort>
                                  <!-- ID Column -->
                                  <ng-container matColumnDef="Nombre">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 20%">
                                      {{ "calendario.nombre" | translate }}
                                    </th>
                                    <td mat-cell *matCellDef="let row">
                                      {{ row.Nombre }}
                                    </td>
                                  </ng-container>

                                  <!-- Progress Column -->
                                  <ng-container matColumnDef="Descripcion">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 20%">
                                      {{ "GLOBAL.descripcion" | translate }}
                                    </th>

                                    <td mat-cell *matCellDef="let row">
                                      {{ row.Descripcion }}
                                    </td>
                                  </ng-container>

                                  <ng-container matColumnDef="FechaInicio">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 20%">
                                      {{
                                      "calendario.fecha_inicio" | translate
                                      }}
                                    </th>
                                    <td mat-cell *matCellDef="let row">
                                      {{ row.FechaInicio }}
                                    </td>
                                  </ng-container>

                                  <ng-container matColumnDef="FechaFin">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 20%">
                                      {{ "calendario.fecha_fin" | translate }}
                                    </th>
                                    <td mat-cell *matCellDef="let row">
                                      {{ row.FechaFin }}
                                    </td>
                                  </ng-container>

                                  <ng-container matColumnDef="Activo">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 20%">
                                      {{ "calendario.estado" | translate }}
                                    </th>
                                    <td mat-cell *matCellDef="let row">
                                      {{ row.Activo }}
                                    </td>
                                  </ng-container>

                                  <ng-container matColumnDef="Acciones">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 20%">
                                      {{ "GLOBAL.acciones" | translate }}
                                    </th>
                                    <td mat-cell *matCellDef="let row">
                                      <button (click)="
                                          onAction(
                                            { action: 'edit', data: row },
                                            process.actividades
                                          )
                                        " title="{{
                                          'calendario.tooltip_editar_actividad'
                                            | translate
                                        }}" mat-icon-button color="accent" [disabled]="view">
                                        <mat-icon aria-hidden="false" fontIcon="edit_outline">
                                        </mat-icon>
                                      </button>
                                      <button (click)="onAction( {action: 'disable', }, process )" title="{{
                                          'calendario.tooltip_eliminar_actividad'
                                            | translate
                                        }}" mat-icon-button color="warn" [disabled]="view">
                                        <mat-icon aria-hidden="false" fontIcon="delete">
                                        </mat-icon>
                                      </button>
                                      <button (click)="
                                          onAction(
                                            { action: 'select', data: row },
                                            process.actividades
                                          )
                                        " title="{{
                                          'calendario.tooltip_seleccionar_proyectos'
                                            | translate
                                        }}" mat-icon-button color="accent" [disabled]="view">
                                        <mat-icon aria-hidden="false" fontIcon="check">
                                        </mat-icon>
                                      </button>
                                      <button (click)="
                                          onAction(
                                            { action: 'view', data: row },
                                            process.actividades
                                          )
                                        " title="{{
                                          'calendario.tooltip_detalle_actividad'
                                            | translate
                                        }}" mat-icon-button color="accent" [disabled]="view">
                                        <mat-icon aria-hidden="false" fontIcon="search">
                                        </mat-icon>
                                      </button>
                                    </td>
                                  </ng-container>

                                  <tr mat-header-row *matHeaderRowDef="
                                      displayedColumnsActividades
                                    "></tr>
                                  <tr mat-row *matRowDef="
                                      let row;
                                      columns: displayedColumnsActividades
                                    "></tr>

                                  <!-- Row shown when there is no matching data. -->
                                  <tr class="mat-row" *matNoDataRow>
                                    <td class="mat-cell" colspan="4">
                                      No data matching the filter "{{
                                      inputActividades.value
                                      }}"
                                    </td>
                                  </tr>
                                </table>
                              </div>
                            </mat-card-content>
                          </mat-card>
                        </mat-expansion-panel>
                      </mat-accordion>
                    </mat-tab>
                  </mat-tab-group>
                </ng-container>
              </div>
            </mat-card-content>
          </mat-card>

          <div class="form-grid2 margin-y">
            <div class="form-col2">
              <ng-container *ngIf="!Extension">
                <button style="width: 100%;" class="float-center boton-primary" mat-flat-button color="accent"
                  type="submit" [disabled]="calendarFormExtend.invalid">
                  {{ "GLOBAL.guardar" | translate }}
                </button>
              </ng-container>
              <ng-container *ngIf="Extension">
                <button class="float-center boton-primary" mat-flat-button color="accent" style="width: 100%;"
                  type="button" (click)="prepareNewExtension()">
                  {{ "calendario.add_extension_extension" | translate }}
                </button>
              </ng-container>
            </div>
          </div>
        </form>
      </mat-card-content>
    </mat-card>
  </mat-tab>
</mat-tab-group>