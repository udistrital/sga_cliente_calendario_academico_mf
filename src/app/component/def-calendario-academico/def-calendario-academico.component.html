<mat-tab-group [(selectedIndex)]="activetab">
  <mat-tab label="{{ 'calendario.definicion' | translate }}">
    <div class="margin-y">
      <h3 class="margin-y">{{ "calendario.title" | translate }}</h3>
      <form
        novalidate
        [formGroup]="calendarForm"
        #fform="ngForm"
        (ngSubmit)="createCalendar($event)"
        class="form-horizontal"
      >
        <div class="form-grid2">
          <div class="form-col1">
            <mat-form-field style="width: 100%" floatLabel="always">
              <mat-label>*{{ "calendario.para" | translate }} </mat-label>
              <mat-select
                formControlName="Nivel"
                placeholder="Pregrado/Posgrado"
                required
                [disabled]="view"
                [(ngModel)]="nivelSeleccionado"
                (selectionChange)="
                  cambiarSelectPeriodoSegunNivel(nivelSeleccionado)
                "
              >
                <mat-option>--Seleccionar--</mat-option>
                <mat-option *ngFor="let nivel of niveles" [value]="nivel.Id">
                  {{ nivel.Nombre }}
                </mat-option>
              </mat-select>
              <mat-error
                *ngIf="
                  calendarForm.get('Nivel').hasError('required') &&
                  calendarForm.get('Nivel').touched
                "
              >
                {{ "calendario.error_select_para" | translate }}
              </mat-error>
            </mat-form-field>
          </div>
          <div class="form-col1">
            <mat-form-field style="width: 100%" floatLabel="always">
              <mat-label>*{{ "calendario.periodo" | translate }}: </mat-label>
              <mat-select
                *ngIf="!selectMultipleNivel"
                formControlName="PeriodoId"
                placeholder="2020-I, 2020-II, 2020-III"
                required
                [disabled]="view"
              >
                <mat-option value="" disabled>--Seleccionar--</mat-option>
                <mat-option
                  *ngFor="let periodo of periodos"
                  [value]="periodo.Id"
                >
                  {{ periodo.Nombre }}
                </mat-option>
              </mat-select>
              <mat-select
                *ngIf="selectMultipleNivel"
                formControlName="PeriodoId"
                placeholder="2020-I, 2020-II, 2020-III"
                required
                multiple
              >
                <mat-option
                  *ngFor="let periodo of periodos"
                  [value]="periodo.Id"
                  [disabled]="view"
                >
                  {{ periodo.Nombre }}
                </mat-option>
              </mat-select>

              <mat-error
                *ngIf="
                  calendarForm.get('PeriodoId').hasError('required') &&
                  calendarForm.get('PeriodoId').touched
                "
              >
                {{ "calendario.error_select_periodo" | translate }}
              </mat-error>
            </mat-form-field>
          </div>
        </div>

        <p class="margin-y">{{ "calendario.resolucion" | translate }}:</p>

        <div class="form-grid2">
          <div class="form-col1">
            <mat-form-field class="form-field">
              <mat-label>{{
                "calendario.numero_resolucion" | translate
              }}</mat-label>
              <input
                matInput
                type="number"
                formControlName="resolucion"
                placeholder="{{ 'calendario.numero_resolucion' | translate }} "
                required
              />
              <mat-error
                *ngIf="
                  calendarForm.get('resolucion').hasError('required') &&
                  calendarForm.get('resolucion').touched
                "
              >
                {{ "calendario.error_resolucion" | translate }}
              </mat-error>
            </mat-form-field>
          </div>
          <div class="form-col1">
            <mat-form-field class="form-field">
              <mat-label>{{
                "calendario.anno_resolucion" | translate
              }}</mat-label>
              <input
                matInput
                type="text"
                formControlName="anno"
                minlength="4"
                maxlength="4"
                pattern="^[0-9]*$"
                placeholder="{{ 'calendario.anno_resolucion' | translate }}"
                required
              />
              <mat-error
                *ngIf="
                  calendarForm.get('anno').hasError('required') &&
                  calendarForm.get('anno').touched &&
                  calendarForm.get('anno').hasError('pattern')
                "
              >
                {{ "calendario.error_anno" | translate }}
              </mat-error>
            </mat-form-field>
          </div>
        </div>
        <div class="col-2" *ngIf="!view">
          <p>{{ "calendario.etiqueta_documento" | translate }}</p>
        </div>
        <div class="margin-y">
          <div *ngIf="uploadMode">
            <button
              mat-flat-button
              color="accent"
              type="button"
              (click)="fileInput.click()"
              title="{{ 'calendario.subir_resolucion' | translate }}"
            >
              <mat-icon fontIcon="attach_file"></mat-icon>
              <input
                formControlName="fileResolucion"
                #fileInput
                type="file"
                (change)="onInputFileResolucion($event)"
                style="display: none"
                accept="application/pdf"
                data-max-size="5120"
              />
            </button>
            <mat-error *ngIf="!fileResolucion">{{
              "ERROR.no_documento" | translate
            }}</mat-error>
            <label style="margin-left: 1em" *ngIf="fileResolucion"
              >{{ "GLOBAL.archivo_seleccionado" | translate }}:
              {{ fileResolucion.file.name }}</label
            >
          </div>
          <div *ngIf="editMode">
            <button
              mat-flat-button
              color="accent"
              type="button"
              (click)="downloadFile(calendar.DocumentoId)"
              title="{{ 'calendario.descargar_resolucion' | translate }}"
              *ngIf="!view"
            >
              <mat-icon fontIcon="cloud_download"></mat-icon>
            </button>
          </div>
        </div>
        <!-- //VOLVER  !createdCalendar -->
        <div class="row" *ngIf="!createdCalendar">
          <button
            mat-flat-button
            color="accent"
            type="submit"
            [disabled]="calendarForm.invalid"
          >
            {{ "GLOBAL.guardar" | translate }}
          </button>
        </div>
      </form>
      <br />
      <mat-divider color="accent"></mat-divider>

      <ng-container *ngIf="createdCalendar" class="margin-y">
        <h3 class="margin-y">
          {{ "calendario.procesos_actividades" | translate }}
        </h3>
        <div *ngIf="activebutton">
          <p class="margin-y">
            {{ "calendario.procesos_descripcion" | translate }}
          </p>
          <div class="container-bottons">
            <button
              mat-flat-button
              color="accent"
              type="button"
              (click)="openTabsClone()"
            >
              {{ "calendario.procesos_copiar" | translate }}
            </button>
            <button
              mat-flat-button
              color="accent"
              type="button"
              (click)="openTabs()"
            >
              {{ "calendario.procesos_definir" | translate }}
            </button>
          </div>
        </div>
        <form
          novalidate
          [formGroup]="calendarFormClone"
          #fform="ngForm"
          *ngIf="activetabsClone"
        >
          <div class="margin-y">
            <p>
              {{ "calendario.clonar_calendario_nombre" | translate }}
            </p>
            <div class="form-grid2">
              <div class="form-col1">
                <mat-form-field style="width: 100%" floatLabel="always">
                  <mat-label>*{{ "calendario.para" | translate }} </mat-label>
                  <mat-select
                    formControlName="NivelClone"
                    placeholder="Pregrado/Posgrado"
                    required
                  >
                    <mat-option>--Seleccionar--</mat-option>
                    <mat-option
                      *ngFor="let nivelClone of niveles"
                      [value]="nivelClone.Id"
                    >
                      {{ nivelClone.Nombre }}
                    </mat-option>
                  </mat-select>
                  <mat-error
                    *ngIf="
                      calendarFormClone
                        .get('NivelClone')
                        ?.hasError('required') &&
                      calendarFormClone.get('NivelClone')?.touched
                    "
                  >
                    {{ "calendario.error_select_para" | translate }}
                  </mat-error>
                </mat-form-field>
              </div>
              <div class="form-col1">
                <mat-form-field style="width: 100%" floatLabel="always">
                  <mat-label
                    >*{{ "calendario.periodo" | translate }}:
                  </mat-label>
                  <mat-select
                    formControlName="PeriodoIdClone"
                    placeholder="2020-I, 2020-II, 2020-III"
                    required
                  >
                    <mat-option>--Seleccionar--</mat-option>
                    <mat-option
                      *ngFor="let periodoClone of periodosClone"
                      [value]="periodoClone.Id"
                    >
                      {{ periodoClone.Nombre }}
                    </mat-option>
                  </mat-select>
                  <mat-error
                    *ngIf="
                      calendarFormClone
                        .get('PeriodoIdClone')
                        ?.hasError('required') &&
                      calendarFormClone.get('PeriodoIdClone')?.touched
                    "
                  >
                    {{ "calendario.error_select_periodo" | translate }}
                  </mat-error>
                </mat-form-field>
              </div>
            </div>
            <div class="form-grid2">
              <div class="form-col2">
                <button
                  class="form-field"
                  mat-flat-button
                  color="accent"
                  type="button"
                  (click)="clonarCalendario()"
                >
                  {{ "calendario.clonar_calendario" | translate }}
                </button>
              </div>
            </div>
          </div>
        </form>
        <div *ngIf="activetabs">
          <mat-tab-group>
            <mat-tab label="{{ 'calendario.procesos' | translate }}">
              <br />

              <!-- BUSCANDOR -->
              <mat-form-field class="form-field">
                <mat-label>{{ "GLOBAL.buscar" | translate }}</mat-label>
                <input
                  matInput
                  type="text"
                  (keyup)="applyFilterProces($event)"
                  placeholder="{{ 'GLOBAL.buscar' | translate }}"
                  #input
                />
              </mat-form-field>

              <!-- BARRA DE HERRAMIENTAS -->
              <mat-toolbar>
                <button
                  mat-icon-button
                  color="accent"
                  type="button"
                  (click)="addProcess($event)"
                  *ngIf="!view"
                  [matTooltip]="'calendario.tooltip_crear_proceso' | translate"
                >
                  <mat-icon fontIcon="add"> </mat-icon>
                </button>
              </mat-toolbar>

              <!-- TABLA -->
              <div class="table" (custom)="onAction($event, null)">
                <table mat-table [dataSource]="dataSource" matSort>
                  <!-- ID Column -->
                  <ng-container matColumnDef="Nombre" sticky>
                    <th
                      mat-header-cell
                      *matHeaderCellDef
                      mat-sort-header
                      style="width: 20%"
                    >
                      {{ "calendario.nombre" | translate }}
                    </th>
                    <td mat-cell *matCellDef="let row">
                      {{ row.Nombre }}
                    </td>
                  </ng-container>
                  <!-- Progress Column -->
                  <ng-container matColumnDef="Descripcion">
                    <th
                      mat-header-cell
                      *matHeaderCellDef
                      mat-sort-header
                      style="width: 80%"
                    >
                      {{ "GLOBAL.descripcion" | translate }}
                    </th>

                    <td mat-cell *matCellDef="let row">
                      {{ row.Descripcion }}
                    </td>
                  </ng-container>

                  <ng-container matColumnDef="Acciones">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>
                      {{ "GLOBAL.acciones" | translate }}
                    </th>
                    <td mat-cell *matCellDef="let row">
                      <button
                        mat-icon-button
                        color="accent"
                        [matMenuTriggerFor]="menu"
                        [matTooltip]="'GLOBAL.acciones' | translate"
                      >
                        <mat-icon>more_vert</mat-icon>
                      </button>
                      <mat-menu #menu="matMenu">
                        <button
                          mat-menu-item
                          (click)="editProcess({ data: row })"
                        >
                          <mat-icon
                            color="accent"
                            aria-hidden="false"
                            fontIcon="edit"
                          ></mat-icon>
                          <span>{{
                            "calendario.tooltip_editar_proceso" | translate
                          }}</span>
                        </button>

                        <button
                          mat-menu-item
                          [disabled]="view"
                          (click)="deleteProcess({ data: row })"
                        >
                          <mat-icon
                            color="warn"
                            aria-hidden="false"
                            fontIcon="delete"
                            class="icon"
                          >
                          </mat-icon>
                          <span>{{
                            "calendario.tooltip_eliminar_proceso" | translate
                          }}</span>
                        </button>
                      </mat-menu>
                    </td>
                  </ng-container>

                  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                  <tr
                    mat-row
                    *matRowDef="let row; columns: displayedColumns"
                  ></tr>

                  <!-- Row shown when there is no matching data. -->
                  <tr class="mat-row" *matNoDataRow>
                    <td class="mat-cell" colspan="4">
                      {{ "calendario.sin_procesos" | translate }}
                    </td>
                  </tr>
                </table>
              </div>
            </mat-tab>

            <mat-tab label="{{ 'calendario.actividades' | translate }}">
              <mat-accordion>
                <mat-expansion-panel
                  *ngFor="let process of processes; index as i"
                >
                  <mat-expansion-panel-header
                    class="mat-expansion-panel-gradient"
                  >
                    <mat-panel-title>
                      {{ i + 1 }}. {{ process.Nombre }}
                    </mat-panel-title>
                  </mat-expansion-panel-header>
                  <br />

                  <!-- BUSCARDOR -->
                  <mat-form-field class="form-field">
                    <mat-label>
                      {{ "GLOBAL.buscar" | translate }}
                    </mat-label>
                    <input
                      matInput
                      type="text"
                      (keyup)="
                        applyFilterActividades($event, process.actividades, i)
                      "
                      placeholder="{{ 'GLOBAL.buscar' | translate }}"
                      #inputActividades
                    />
                  </mat-form-field>

                  <!-- BARRA DE HERRAMIENTAS -->
                  <mat-toolbar>
                    <button
                      mat-icon-button
                      color="accent"
                      (click)="addActivity($event, process)"
                      *ngIf="!view"
                      [matTooltip]="
                        'calendario.tooltip_crear_actividad' | translate
                      "
                    >
                      <mat-icon style="vertical-align: middle" fontIcon="add">
                      </mat-icon>
                    </button>
                  </mat-toolbar>

                  <!-- TABLA -->
                  <div class="table">
                    <table mat-table [dataSource]="process.actividades" matSort>
                      <!-- ID Column -->
                      <ng-container matColumnDef="Nombre">
                        <th
                          mat-header-cell
                          *matHeaderCellDef
                          mat-sort-header
                          style="width: 20%"
                        >
                          {{ "calendario.nombre" | translate }}
                        </th>
                        <td mat-cell *matCellDef="let row">
                          {{ row.Nombre }}
                        </td>
                      </ng-container>

                      <!-- Progress Column -->
                      <ng-container matColumnDef="Descripcion">
                        <th
                          mat-header-cell
                          *matHeaderCellDef
                          mat-sort-header
                          style="width: 20%"
                        >
                          {{ "GLOBAL.descripcion" | translate }}
                        </th>

                        <td mat-cell *matCellDef="let row">
                          {{ row.Descripcion }}
                        </td>
                      </ng-container>

                      <ng-container matColumnDef="FechaInicio">
                        <th
                          mat-header-cell
                          *matHeaderCellDef
                          mat-sort-header
                          style="width: 20%"
                        >
                          {{ "calendario.fecha_inicio" | translate }}
                        </th>
                        <td mat-cell *matCellDef="let row">
                          {{ row.FechaInicio }}
                        </td>
                      </ng-container>

                      <ng-container matColumnDef="FechaFin">
                        <th
                          mat-header-cell
                          *matHeaderCellDef
                          mat-sort-header
                          style="width: 20%"
                        >
                          {{ "calendario.fecha_fin" | translate }}
                        </th>
                        <td mat-cell *matCellDef="let row">
                          {{ row.FechaFin }}
                        </td>
                      </ng-container>

                      <ng-container matColumnDef="Activo">
                        <th
                          mat-header-cell
                          *matHeaderCellDef
                          mat-sort-header
                          style="width: 20%"
                        >
                          {{ "calendario.estado" | translate }}
                        </th>
                        <td mat-cell *matCellDef="let row">
                          {{ row.Activo }}
                        </td>
                      </ng-container>

                      <ng-container matColumnDef="Acciones">
                        <th
                          mat-header-cell
                          *matHeaderCellDef
                          mat-sort-header
                          style="width: 20%"
                        >
                          {{ "GLOBAL.acciones" | translate }}
                        </th>
                        <td mat-cell *matCellDef="let row">
                          <button
                            mat-icon-button
                            [matMenuTriggerFor]="menu"
                            [matTooltip]="'GLOBAL.acciones' | translate"
                            color="accent"
                          >
                            <mat-icon>more_vert</mat-icon>
                          </button>
                          <mat-menu #menu="matMenu">
                            <button
                              mat-menu-item
                              (click)="
                                onAction(
                                  { action: 'edit', data: row },
                                  process.actividades
                                )
                              "
                              [disabled]="view"
                            >
                              <mat-icon
                                color="accent"
                                aria-hidden="false"
                                fontIcon="edit_outline"
                              ></mat-icon>
                              <span>{{
                                "calendario.tooltip_editar_actividad"
                                  | translate
                              }}</span>
                            </button>
                            <button
                              mat-menu-item
                              (click)="
                                onAction(
                                  { action: 'delete', data: row },
                                  process
                                )
                              "
                              [disabled]="view"
                            >
                              <mat-icon
                                color="warn"
                                aria-hidden="false"
                                fontIcon="delete"
                              >
                              </mat-icon>
                              <span>{{
                                "calendario.tooltip_eliminar_actividad"
                                  | translate
                              }}</span>
                            </button>
                            <button
                              mat-menu-item
                              (click)="
                                onAction(
                                  { action: 'select', data: row },
                                  process.actividades
                                )
                              "
                              [disabled]="view"
                            >
                              <mat-icon
                                color="accent"
                                aria-hidden="false"
                                fontIcon="check"
                              >
                              </mat-icon>
                              <span>{{
                                "calendario.tooltip_seleccionar_proyectos"
                                  | translate
                              }}</span>
                            </button>
                            <button
                              mat-menu-item
                              (click)="
                                onAction(
                                  { action: 'view', data: row },
                                  process.actividades
                                )
                              "
                              [disabled]="view"
                            >
                              <mat-icon
                                color="accent"
                                aria-hidden="false"
                                fontIcon="search"
                              >
                              </mat-icon>
                              <span>{{
                                "calendario.tooltip_detalle_actividad"
                                  | translate
                              }}</span>
                            </button>
                          </mat-menu>
                        </td>
                      </ng-container>

                      <tr
                        mat-header-row
                        *matHeaderRowDef="displayedColumnsActividades"
                      ></tr>
                      <tr
                        mat-row
                        *matRowDef="
                          let row;
                          columns: displayedColumnsActividades
                        "
                      ></tr>

                      <!-- Row shown when there is no matching data. -->
                      <tr class="mat-row" *matNoDataRow>
                        <td class="mat-cell" colspan="4">
                          No data matching the filter "{{
                            inputActividades.value
                          }}"
                        </td>
                      </tr>
                    </table>
                  </div>
                </mat-expansion-panel>
              </mat-accordion>
            </mat-tab>
          </mat-tab-group>
        </div>
      </ng-container>
    </div>
  </mat-tab>

  <!-- ///////////// No tocar de aqui para arriba ///////////// -->

  <mat-tab label="{{ 'calendario.formulario_extension' | translate }}">
    
    <div class="margin-y">
      <h3 class="margin-y">{{ "calendario.title" | translate }}</h3>
      <ng-container *ngIf="showList">
        <mat-form-field style="width: 100%" floatLabel="always">
          <mat-label>
            {{ "calendario.seleccione_version_calendario" | translate }}
          </mat-label>
          <mat-select
            placeholder="{{
              'calendario.seleccione_version_calendario' | translate
            }}"
            [(value)]="selCalendar"
          >
            <mat-option
              *ngFor="let Calendar of ExtensionList"
              (click)="loadExtension(Calendar.Id)"
              [value]="Calendar.Id"
            >
              {{ Calendar.Nombre }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </ng-container>
      <form
        novalidate
        [formGroup]="calendarFormExtend"
        #fform="ngForm"
        (ngSubmit)="extendCalendar($event)"
        class="form-horizontal"
      >
        <section>
          <div class="form-grid2">
            <div class="form-col1">
              <mat-form-field style="width: 100%" floatLabel="always">
                <mat-label>*{{ "calendario.para" | translate }} </mat-label>
                <mat-select
                  formControlName="Nivel"
                  placeholder="Pregrado/Posgrado"
                  required
                  [disabled]="view"
                >
                  <mat-option>--Seleccionar--</mat-option>
                  <mat-option *ngFor="let nivel of niveles" [value]="nivel.Id">
                    {{ nivel.Nombre }}
                  </mat-option>
                </mat-select>
                <mat-error
                  *ngIf="
                    calendarFormExtend.get('Nivel').hasError('required') &&
                    calendarFormExtend.get('Nivel').touched
                  "
                >
                  {{ "calendario.error_select_para" | translate }}
                </mat-error>
              </mat-form-field>
            </div>
            <div class="form-col1">
              <mat-form-field style="width: 100%" floatLabel="always">
                <mat-label>*{{ "calendario.periodo" | translate }}: </mat-label>
                <mat-select
                  *ngIf="!selectMultipleNivel"
                  formControlName="PeriodoId"
                  placeholder="2020-I, 2020-II, 2020-III"
                  required
                  [disabled]="view"
                >
                  <mat-option value="" disabled>--Seleccionar--</mat-option>
                  <mat-option
                    *ngFor="let periodo of periodos"
                    [value]="periodo.Id"
                  >
                    {{ periodo.Nombre }}
                  </mat-option>
                </mat-select>
                <mat-select
                  *ngIf="selectMultipleNivel"
                  formControlName="PeriodoId"
                  placeholder="2020-I, 2020-II, 2020-III"
                  required
                  multiple
                >
                  <mat-option
                    *ngFor="let periodo of periodos"
                    [disabled]="view"
                    [value]="periodo.Id"
                  >
                    {{ periodo.Nombre }}
                  </mat-option>
                </mat-select>
                <mat-error
                  *ngIf="
                    calendarFormExtend.get('PeriodoId').hasError('required') &&
                    calendarFormExtend.get('PeriodoId').touched
                  "
                >
                  {{ "calendario.error_select_periodo" | translate }}
                </mat-error>
              </mat-form-field>
            </div>
          </div>
        </section>

        <mat-divider class="margin-y"></mat-divider>

        <section>
          <p class="margin-y">
            {{ "calendario.resolucion_extension" | translate }}:
          </p>
          <div class="form-grid2">
            <div class="form-col1">
              <mat-form-field class="form-field">
                <mat-label>{{
                  "calendario.numero_resolucion" | translate
                }}</mat-label>
                <input
                  matInput
                  type="number"
                  formControlName="resolucion"
                  placeholder="{{ 'calendario.numero_resolucion' | translate }}"
                  required
                />
                <mat-error
                  *ngIf="
                    calendarFormExtend.get('resolucion').hasError('required') &&
                    calendarFormExtend.get('resolucion').touched
                  "
                >
                  {{ "calendario.error_resolucion" | translate }}
                </mat-error>
              </mat-form-field>
            </div>
            <div class="form-col1">
              <mat-form-field class="form-field">
                <mat-label>{{
                  "calendario.anno_resolucion" | translate
                }}</mat-label>
                <input
                  matInput
                  type="text"
                  formControlName="anno"
                  minlength="4"
                  maxlength="4"
                  pattern="^[0-9]*$"
                  placeholder="{{ 'calendario.anno_resolucion' | translate }}"
                  required
                />
                <mat-error
                  *ngIf="
                    calendarFormExtend.get('anno').hasError('required') &&
                    calendarFormExtend.get('anno').touched &&
                    calendarForm.get('anno').hasError('pattern')
                  "
                >
                  {{ "calendario.error_anno" | translate }}
                </mat-error>
              </mat-form-field>
            </div>
          </div>
          <p *ngIf="!view" class="margin-y">
            {{ "calendario.etiqueta_documento" | translate }}
          </p>
          <div *ngIf="!Extension">
            <button
              mat-flat-button
              color="accent"
              type="button"
              (click)="fileInput.click()"
              matTooltip="{{ 'calendario.subir_resolucion' | translate }}"
              *ngIf="!view"
            >
              <mat-icon fontIcon="attach_file"></mat-icon>
              <input
                formControlName="fileResolucion"
                #fileInput
                type="file"
                (change)="onInputFileResolucionExt($event)"
                style="display: none"
                accept="application/pdf"
                data-max-size="5120"
              />
            </button>
            <mat-error
              *ngIf="
                calendarFormExtend.get('fileResolucion').hasError('required')
              "
              >{{ "ERROR.no_documento" | translate }}</mat-error
            >
            <label *ngIf="fileResolucionExt" style="margin-left: 1em"
              >{{ "GLOBAL.archivo_seleccionado" | translate }}:
              {{ fileResolucionExt.file.name }}</label
            >
          </div>
          <div *ngIf="Extension">
            <button
              mat-flat-button
              color="accent"
              type="button"
              (click)="downloadFileExt(fileExtId)"
              matTooltip="{{ 'calendario.descargar_resolucion' | translate }}"
              *ngIf="!view"
            >
              <mat-icon fontIcon="cloud_download"></mat-icon>
            </button>
          </div>
        </section>

        <mat-divider class="margin-y"></mat-divider>

        <section>
          <div class="alert info margin-y">
            {{ "calendario.extension_proyectos_info" | translate }}
          </div>
          <h3 class="margin-y">
            {{ "calendario.programas_curriculares" | translate }}
          </h3>
          <mat-form-field class="form-field">
            <mat-label>{{
              "calendario.seleccione_proyecto" | translate
            }}</mat-label>
            <mat-select
              formControlName="selProyectos"
              [disabled]="
                calendarFormExtend.get('fileResolucion').hasError('required') &&
                !Extension
              "
              multiple
              [disabled]="view"
            >
              <mat-option value="0" disabled>{{
                "calendario.seleccione_proyecto" | translate
              }}</mat-option>
              <mat-option *ngFor="let project of projects" [value]="project.Id"
                >{{ project.Nombre }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </section>

        <mat-divider class="margin-y"></mat-divider>

        <section *ngIf="createdCalendar" class="margin-y">
          <h3>
            {{ "calendario.procesos_actividades" | translate }}
          </h3>
          <div *ngIf="activetabs">
            <!-- PRIMER MAT TAB GROUP -->
            <ng-container *ngIf="!Extension && !Ext_Extension">
              <mat-tab-group>
                <mat-tab label="{{ 'calendario.procesos' | translate }}">
                  <br />

                  <!-- BUSCADOR -->
                  <mat-form-field style="width: 100%">
                    <mat-label>{{ "GLOBAL.buscar" | translate }}</mat-label>
                    <input
                      matInput
                      (keyup)="applyFilterProces($event)"
                      placeholder="{{ 'GLOBAL.buscar' | translate }}"
                      #input
                    />
                  </mat-form-field>

                  <!-- BARRA DE HERRAMIENTAS -->
                  <mat-toolbar>
                    <button
                      mat-icon-button
                      color="accent"
                      type="button"
                      (click)="addProcess($event)"
                      *ngIf="!view"
                      [matTooltip]="
                        'calendario.tooltip_crear_proceso' | translate
                      "
                    >
                      <mat-icon fontIcon="add"> </mat-icon>
                    </button>
                  </mat-toolbar>

                  <!-- TABLA -->
                  <div class="table" (custom)="onAction($event, null)">
                    <table
                      mat-table
                      [dataSource]="dataSource"
                      class="demo-table"
                      matSort
                    >
                      <!-- ID Column -->
                      <ng-container matColumnDef="Nombre" sticky>
                        <th
                          [style]="{ 'text-align': 'left' }"
                          mat-header-cell
                          *matHeaderCellDef
                          mat-sort-header
                          style="width: 20%"
                        >
                          {{ "calendario.nombre" | translate }}
                        </th>
                        <td mat-cell *matCellDef="let row">
                          {{ row.Nombre }}
                        </td>
                      </ng-container>
                      <!-- Progress Column -->
                      <ng-container matColumnDef="Descripcion">
                        <th
                          mat-header-cell
                          *matHeaderCellDef
                          mat-sort-header
                          style="width: 80%"
                        >
                          {{ "GLOBAL.descripcion" | translate }}
                        </th>

                        <td mat-cell *matCellDef="let row">
                          {{ row.Descripcion }}
                        </td>
                      </ng-container>

                      <ng-container matColumnDef="Acciones">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>
                          {{ "GLOBAL.acciones" | translate }}
                        </th>
                        <td mat-cell *matCellDef="let row">
                          <button
                            mat-icon-button
                            color="accent"
                            [matMenuTriggerFor]="menuProcesosExtension"
                            [matTooltip]="'GLOBAL.acciones' | translate"
                          >
                            <mat-icon>more_vert</mat-icon>
                          </button>
                          <mat-menu #menuProcesosExtension="matMenu">
                            <button
                              mat-menu-item
                              (click)="editProcess({ data: row })"
                              [disabled]="view"
                            >
                              <mat-icon color="accent" fontIcon="edit">
                              </mat-icon>
                              <span>{{
                                "calendario.tooltip_detalle_proceso" | translate
                              }}</span>
                            </button>
                            <button
                              mat-menu-item
                              (click)="
                                onAction({ action: 'view', data: row }, null)
                              "
                              [disabled]="view"
                            >
                              <mat-icon color="warn" fontIcon="delete">
                              </mat-icon>
                              <span>{{
                                "calendario.tooltip_detalle_proceso" | translate
                              }}</span>
                            </button>
                          </mat-menu>
                        </td>
                      </ng-container>

                      <tr
                        mat-header-row
                        *matHeaderRowDef="displayedColumns"
                      ></tr>
                      <tr
                        mat-row
                        *matRowDef="let row; columns: displayedColumns"
                      ></tr>

                      <!-- Row shown when there is no matching data. -->
                      <tr class="mat-row" *matNoDataRow>
                        <td class="mat-cell" colspan="4">
                          {{ "calendario.sin_procesos" | translate }}
                        </td>
                      </tr>
                    </table>
                  </div>
                </mat-tab>
                <mat-tab label="{{ 'calendario.actividades' | translate }}">
                  <mat-accordion>
                    <mat-expansion-panel
                      *ngFor="let process of processes; index as i"
                    >
                      <mat-expansion-panel-header
                        class="mat-expansion-panel-gradient"
                      >
                        <mat-panel-title>
                          {{ i + 1 }}. {{ process.Nombre }}
                        </mat-panel-title>
                      </mat-expansion-panel-header>
                      <mat-card class="margin-y">
                        <mat-card-content>
                          <!-- BUSCADOR -->

                          <mat-form-field class="form-field">
                            <mat-label>{{
                              "GLOBAL.buscar" | translate
                            }}</mat-label>
                            <input
                              matInput
                              (keyup)="
                                applyFilterActividades(
                                  $event,
                                  process.actividades,
                                  i
                                )
                              "
                              placeholder="{{ 'GLOBAL.buscar' | translate }}"
                              #inputActividades
                            />
                          </mat-form-field>

                          <!-- BARRA DE HERRAMIENTAS -->
                          <mat-toolbar>
                            <button
                              mat-icon-button
                              color="accent"
                              (click)="addActivity($event, process)"
                              *ngIf="!view"
                              [matTooltip]="
                                'calendario.tooltip_crear_actividad' | translate
                              "
                            >
                              <mat-icon
                                style="vertical-align: middle"
                                fontIcon="add"
                              >
                              </mat-icon>
                            </button>
                          </mat-toolbar>

                          <!-- TABLA -->
                          <div class="table">
                            <table
                              mat-table
                              [dataSource]="process.actividades"
                              matSort
                            >
                              <!-- ID Column -->
                              <ng-container matColumnDef="Nombre">
                                <th
                                  mat-header-cell
                                  *matHeaderCellDef
                                  mat-sort-header
                                  style="width: 20%"
                                >
                                  {{ "calendario.nombre" | translate }}
                                </th>
                                <td mat-cell *matCellDef="let row">
                                  {{ row.Nombre }}
                                </td>
                              </ng-container>

                              <!-- Progress Column -->
                              <ng-container matColumnDef="Descripcion">
                                <th
                                  mat-header-cell
                                  *matHeaderCellDef
                                  mat-sort-header
                                  style="width: 20%"
                                >
                                  {{ "GLOBAL.descripcion" | translate }}
                                </th>

                                <td mat-cell *matCellDef="let row">
                                  {{ row.Descripcion }}
                                </td>
                              </ng-container>

                              <ng-container matColumnDef="FechaInicio">
                                <th
                                  mat-header-cell
                                  *matHeaderCellDef
                                  mat-sort-header
                                  style="width: 20%"
                                >
                                  {{ "calendario.fecha_inicio" | translate }}
                                </th>
                                <td mat-cell *matCellDef="let row">
                                  {{ row.FechaInicio }}
                                </td>
                              </ng-container>

                              <ng-container matColumnDef="FechaFin">
                                <th
                                  mat-header-cell
                                  *matHeaderCellDef
                                  mat-sort-header
                                  style="width: 20%"
                                >
                                  {{ "calendario.fecha_fin" | translate }}
                                </th>
                                <td mat-cell *matCellDef="let row">
                                  {{ row.FechaFin }}
                                </td>
                              </ng-container>

                              <ng-container matColumnDef="Activo">
                                <th
                                  mat-header-cell
                                  *matHeaderCellDef
                                  mat-sort-header
                                  style="width: 20%"
                                >
                                  {{ "calendario.estado" | translate }}
                                </th>
                                <td mat-cell *matCellDef="let row">
                                  {{ row.Activo }}
                                </td>
                              </ng-container>

                              <ng-container matColumnDef="Acciones">
                                <th
                                  mat-header-cell
                                  *matHeaderCellDef
                                  mat-sort-header
                                  style="width: 20%"
                                >
                                  {{ "GLOBAL.acciones" | translate }}
                                </th>
                                <td mat-cell *matCellDef="let row">
                                  <button
                                    mat-icon-button
                                    color="accent"
                                    [matMenuTriggerFor]="menu3"
                                    [matTooltip]="'GLOBAL.acciones' | translate"
                                  >
                                    <mat-icon>more_vert</mat-icon>
                                  </button>
                                  <mat-menu #menu3="matMenu">
                                    <button
                                      mat-menu-item
                                      (click)="
                                        onAction(
                                          { action: 'edit', data: row },
                                          process.actividades
                                        )
                                      "
                                      [disabled]="view"
                                    >
                                      <mat-icon
                                        color="accent"
                                        fontIcon="edit_outline"
                                      ></mat-icon>
                                      <span>{{
                                        "calendario.tooltip_editar_actividad"
                                          | translate
                                      }}</span>
                                    </button>
                                    <button
                                      (click)="onAction( {action: 'disable', }, process )"
                                      mat-menu-item
                                      [disabled]="view"
                                    >
                                      <mat-icon color="warn" fontIcon="delete">
                                      </mat-icon>
                                      <span>{{
                                        "calendario.tooltip_eliminar_actividad"
                                          | translate
                                      }}</span>
                                    </button>
                                    <button
                                      (click)="
                                        onAction(
                                          { action: 'select', data: row },
                                          process.actividades
                                        )
                                      "
                                      mat-menu-item
                                      [disabled]="view"
                                    >
                                      <mat-icon color="accent" fontIcon="check">
                                      </mat-icon>
                                      <span>{{
                                        "calendario.tooltip_seleccionar_proyectos"
                                          | translate
                                      }}</span>
                                    </button>
                                    <button
                                      (click)="
                                        onAction(
                                          { action: 'view', data: row },
                                          process.actividades
                                        )
                                      "
                                      mat-menu-item
                                      [disabled]="view"
                                    >
                                      <mat-icon
                                        color="accent"
                                        fontIcon="search"
                                      >
                                      </mat-icon>
                                      <span>{{
                                        "calendario.tooltip_detalle_actividad"
                                          | translate
                                      }}</span>
                                    </button>
                                  </mat-menu>
                                </td>
                              </ng-container>

                              <tr
                                mat-header-row
                                *matHeaderRowDef="displayedColumnsActividades"
                              ></tr>
                              <tr
                                mat-row
                                *matRowDef="
                                  let row;
                                  columns: displayedColumnsActividades
                                "
                              ></tr>

                              <!-- Row shown when there is no matching data. -->
                              <tr class="mat-row" *matNoDataRow>
                                <td class="mat-cell" colspan="4">
                                  No data matching the filter "{{
                                    inputActividades.value
                                  }}"
                                </td>
                              </tr>
                            </table>
                          </div>
                        </mat-card-content>
                      </mat-card>
                    </mat-expansion-panel>
                  </mat-accordion>
                </mat-tab>
              </mat-tab-group>
            </ng-container>

            <!-- SEGUNDO MAT TAB GROUP -->
            <ng-container *ngIf="Extension || Ext_Extension">
              <mat-tab-group>
                <mat-tab label="{{ 'calendario.procesos' | translate }}">
                  <!-- BUSCARDOR -->
                  <mat-form-field style="width: 100%">
                    <mat-label>{{ "GLOBAL.buscar" | translate }}</mat-label>
                    <input
                      matInput
                      (keyup)="applyFilterProces($event)"
                      placeholder="{{ 'GLOBAL.buscar' | translate }}"
                      #input
                    />
                  </mat-form-field>

                  <!-- BARRA DE HERRAMIENTAS -->
                  <mat-toolbar>
                    <button
                      mat-icon-button
                      color="accent"
                      type="button"
                      (click)="addProcess($event)"
                      *ngIf="!view"
                      [matTooltip]="
                        'calendario.tooltip_crear_proceso' | translate
                      "
                    >
                      <mat-icon fontIcon="add"> </mat-icon>
                    </button>
                  </mat-toolbar>

                  <!-- TABLA -->
                  <div class="table" (custom)="onAction($event, null)">
                    <table
                      mat-table
                      [dataSource]="datasourceExtension"
                      class="demo-table"
                      matSort
                    >
                      <!-- ID Column -->
                      <ng-container matColumnDef="Nombre" sticky>
                        <th
                          class="text-left"
                          mat-header-cell
                          *matHeaderCellDef
                          mat-sort-header
                          style="width: 20%"
                        >
                          {{ "calendario.nombre" | translate }}
                        </th>
                        <td mat-cell *matCellDef="let row">
                          {{ row.Nombre }}
                        </td>
                      </ng-container>
                      <!-- Progress Column -->
                      <ng-container matColumnDef="Descripcion">
                        <th
                          mat-header-cell
                          *matHeaderCellDef
                          mat-sort-header
                          style="width: 80%"
                        >
                          {{ "GLOBAL.descripcion" | translate }}
                        </th>

                        <td mat-cell *matCellDef="let row">
                          {{ row.Descripcion }}
                        </td>
                      </ng-container>

                      <ng-container matColumnDef="Acciones">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>
                          {{ "GLOBAL.acciones" | translate }}
                        </th>
                        <td mat-cell *matCellDef="let row">
                          <button
                            mat-icon-button
                            color="accent"
                            [matMenuTriggerFor]="menuProcesosExtension1"
                            [matTooltip]="'GLOBAL.acciones' | translate"
                          >
                            <mat-icon>more_vert</mat-icon>
                          </button>

                          <mat-menu #menuProcesosExtension1="matMenu">
                            <button
                              mat-menu-item
                              (click)="editProcess({ data: row })"
                              [disabled]="view"
                            >
                              <mat-icon fontIcon="edit" color="accent">
                              </mat-icon>
                              <span>{{
                                "calendario.tooltip_editar_proceso" | translate
                              }}</span>
                            </button>
                            <button
                              mat-menu-item
                              (click)="deleteProcess($event)"
                              [disabled]="view"
                            >
                              <mat-icon color="accent" fontIcon="delete">
                              </mat-icon>
                              <span>{{
                                "calendario.tooltip_detalle_proceso" | translate
                              }}</span>
                            </button>
                          </mat-menu>
                        </td>
                      </ng-container>

                      <tr
                        mat-header-row
                        *matHeaderRowDef="displayedColumnsExtension"
                      ></tr>
                      <tr
                        mat-row
                        *matRowDef="let row; columns: displayedColumnsExtension"
                      ></tr>

                      <!-- Row shown when there is no matching data. -->
                      <tr class="mat-row" *matNoDataRow>
                        <td class="mat-cell" colspan="4">
                          {{ "calendario.sin_procesos" | translate }}
                        </td>
                      </tr>
                    </table>
                  </div>
                </mat-tab>
                <mat-tab label="{{ 'calendario.actividades' | translate }}">
                  <mat-accordion>
                    <mat-expansion-panel
                      *ngFor="let process of processesExt; index as i"
                    >
                      <mat-expansion-panel-header
                        class="mat-expansion-panel-gradient"
                      >
                        <mat-panel-title>
                          {{ i + 1 }}. {{ process.Nombre }}
                        </mat-panel-title>
                      </mat-expansion-panel-header>
                      <br />

                      <!-- BUSCARDOR -->
                      <mat-form-field style="width: 100%">
                        <mat-label>{{ "GLOBAL.buscar" | translate }}</mat-label>
                        <input
                          matInput
                          (keyup)="
                            applyFilterActividades(
                              $event,
                              process.actividades,
                              i
                            )
                          "
                          placeholder="{{ 'GLOBAL.buscar' | translate }}"
                          #inputActividades
                        />
                      </mat-form-field>

                      <!-- BARRA DE HERRAMIENTAS -->
                      <mat-toolbar>
                        <button
                          mat-icon-button
                          color="accent"
                          type="button"
                          (click)="addActivity($event, process)"
                          *ngIf="!view"
                          [matTooltip]="
                            'calendario.tooltip_crear_actividad' | translate
                          "
                        >
                          <mat-icon
                            style="vertical-align: middle"
                            fontIcon="add"
                          >
                          </mat-icon>
                        </button>
                      </mat-toolbar>

                      <!-- TABLA -->
                      <div class="table">
                        <table
                          mat-table
                          [dataSource]="process.actividades"
                          matSort
                        >
                          <!-- ID Column -->
                          <ng-container matColumnDef="Nombre">
                            <th
                              mat-header-cell
                              *matHeaderCellDef
                              mat-sort-header
                              style="width: 20%"
                            >
                              {{ "calendario.nombre" | translate }}
                            </th>
                            <td mat-cell *matCellDef="let row">
                              {{ row.Nombre }}
                            </td>
                          </ng-container>

                          <!-- Progress Column -->
                          <ng-container matColumnDef="Descripcion">
                            <th
                              mat-header-cell
                              *matHeaderCellDef
                              mat-sort-header
                              style="width: 20%"
                            >
                              {{ "GLOBAL.descripcion" | translate }}
                            </th>

                            <td mat-cell *matCellDef="let row">
                              {{ row.Descripcion }}
                            </td>
                          </ng-container>

                          <ng-container matColumnDef="FechaInicio">
                            <th
                              mat-header-cell
                              *matHeaderCellDef
                              mat-sort-header
                              style="width: 20%"
                            >
                              {{ "calendario.fecha_inicio" | translate }}
                            </th>
                            <td mat-cell *matCellDef="let row">
                              {{ row.FechaInicio }}
                            </td>
                          </ng-container>

                          <ng-container matColumnDef="FechaFin">
                            <th
                              mat-header-cell
                              *matHeaderCellDef
                              mat-sort-header
                              style="width: 20%"
                            >
                              {{ "calendario.fecha_fin" | translate }}
                            </th>
                            <td mat-cell *matCellDef="let row">
                              {{ row.FechaFin }}
                            </td>
                          </ng-container>

                          <ng-container matColumnDef="Activo">
                            <th
                              mat-header-cell
                              *matHeaderCellDef
                              mat-sort-header
                              style="width: 20%"
                            >
                              {{ "calendario.estado" | translate }}
                            </th>
                            <td mat-cell *matCellDef="let row">
                              {{ row.Activo }}
                            </td>
                          </ng-container>

                          <ng-container matColumnDef="Acciones">
                            <th
                              mat-header-cell
                              *matHeaderCellDef
                              mat-sort-header
                              style="width: 20%"
                            >
                              {{ "GLOBAL.acciones" | translate }}
                            </th>
                            <td mat-cell *matCellDef="let row">
                              <button
                                mat-icon-button
                                [matMenuTriggerFor]="menuActividadesExtension2"
                                [matTooltip]="'GLOBAL.acciones' | translate"
                                color="accent"
                              >
                                <mat-icon>more_vert</mat-icon>
                              </button>

                              <mat-menu #menuActividadesExtension2="matMenu">
                                <button
                                  mat-menu-item
                                  (click)="
                                    onAction(
                                      { action: 'edit', data: row },
                                      process.actividades
                                    )
                                  "
                                  [disabled]="view"
                                >
                                  <mat-icon
                                    color="accent"
                                    fontIcon="edit_outline"
                                  >
                                  </mat-icon>
                                  <span>{{
                                    "calendario.tooltip_editar_actividad"
                                      | translate
                                  }}</span>
                                </button>
                                <button
                                  mat-menu-item
                                  (click)="onAction( {action: 'disable', }, process )"
                                  [disabled]="view"
                                >
                                  <mat-icon color="warn" fontIcon="delete">
                                  </mat-icon>
                                  <span>{{
                                    "calendario.tooltip_eliminar_actividad"
                                      | translate
                                  }}</span>
                                </button>
                                <button
                                  mat-menu-item
                                  (click)="
                                    onAction(
                                      { action: 'select', data: row },
                                      process.actividades
                                    )
                                  "
                                  [disabled]="view"
                                >
                                  <mat-icon color="accent" fontIcon="check">
                                  </mat-icon>
                                  <span>{{
                                    "calendario.tooltip_seleccionar_proyectos"
                                      | translate
                                  }}</span>
                                </button>
                                <button
                                  mat-menu-item
                                  (click)="
                                    onAction(
                                      { action: 'view', data: row },
                                      process.actividades
                                    )
                                  "
                                  [disabled]="view"
                                >
                                  <mat-icon color="accent" fontIcon="search">
                                  </mat-icon>
                                  <span>{{
                                    "calendario.tooltip_detalle_actividad"
                                      | translate
                                  }}</span>
                                </button>
                              </mat-menu>
                            </td>
                          </ng-container>

                          <tr
                            mat-header-row
                            *matHeaderRowDef="displayedColumnsActividades"
                          ></tr>
                          <tr
                            mat-row
                            *matRowDef="
                              let row;
                              columns: displayedColumnsActividades
                            "
                          ></tr>

                          <!-- Row shown when there is no matching data. -->
                          <tr class="mat-row" *matNoDataRow>
                            <td class="mat-cell" colspan="4">
                              No data matching the filter "{{
                                inputActividades.value
                              }}"
                            </td>
                          </tr>
                        </table>
                      </div>
                    </mat-expansion-panel>
                  </mat-accordion>
                </mat-tab>
              </mat-tab-group>
            </ng-container>
          </div>
        </section>

        <div class="form-grid2 margin-y">
          <div class="form-col2">
            <ng-container *ngIf="!Extension">
              <button
                style="width: 100%"
                class="float-center boton-primary"
                mat-flat-button
                color="accent"
                type="submit"
                [disabled]="calendarFormExtend.invalid"
              >
                {{ "GLOBAL.guardar" | translate }}
              </button>
            </ng-container>
            <ng-container *ngIf="Extension">
              <button
                class="float-center boton-primary"
                mat-flat-button
                color="accent"
                style="width: 100%"
                type="button"
                (click)="prepareNewExtension()"
              >
                {{ "calendario.add_extension_extension" | translate }}
              </button>
            </ng-container>
          </div>
        </div>
      </form>
    </div>
  </mat-tab>
</mat-tab-group>
