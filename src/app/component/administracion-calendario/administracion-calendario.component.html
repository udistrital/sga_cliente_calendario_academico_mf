<mat-card class="mat-card">
  <mat-card-header>
    <mat-card-title
      ><b>
        {{ "calendario.administración_calendario_proyecto" | translate }}
      </b></mat-card-title
    >
  </mat-card-header>

  <mat-card-content>
    <br />

    <mat-card>
      <mat-card-header>
        <mat-card-title>
          {{ "calendario.informacion_general" | translate }}
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <br />
        <div *ngIf="IsAdmin">
          <mat-form-field style="width: 100%">
            <mat-label>
              {{ "proyecto.nivel_proyecto" | translate }}
            </mat-label>
            <mat-select
              [(ngModel)]="nivelesSelected"
              (selectionChange)="onSelectLevel()"
            >
              <mat-option *ngFor="let nivel of niveles" [value]="nivel">
                {{ nivel.Nombre }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <mat-form-field style="width: 100%">
          <mat-label>
            {{ "calendario.proyecto_curricular" | translate }}
          </mat-label>
          <mat-select
            [(ngModel)]="proyectoSelected"
            (selectionChange)="onSelectPrograma()"
          >
            <mat-option *ngFor="let proyecto of Proyectos" [value]="proyecto">
              {{ proyecto.Nombre }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field style="width: 100%">
          <mat-label>
            {{ "calendario.calendario_academico" | translate }}
          </mat-label>
          <input
            matInput
            type="text"
            placeholder="{{ 'calendario.calendario_academico' | translate }}"
            [value]="Calendario_academico"
            readonly
          />
        </mat-form-field>
      </mat-card-content>
    </mat-card>

    <br />

    <mat-card>
      <mat-card-header>
        <mat-card-title>
          {{ "calendario.procesos_actividades" | translate }}</mat-card-title
        >
      </mat-card-header>
      <mat-card-content>
        <mat-tab-group>
          <mat-tab label="{{ 'calendario.procesos' | translate }}">
            <br />
            <mat-card>
              <mat-card-content>
                <!-- Aquí va el contenido de procesos -->
                <mat-form-field style="width: 100%">
                  <mat-label>{{ "GLOBAL.buscar" | translate }}</mat-label>
                  <input
                    matInput
                    (keyup)="applyFilterProces($event)"
                    placeholder="{{ 'GLOBAL.buscar' | translate }}"
                    #input
                  />
                  <mat-icon class="icon-search" matPrefix>search</mat-icon>
                </mat-form-field>

                <div
                  class="mat-elevation-z8 table"
                  (custom)="onAction($event, null)"
                >
                  <table mat-table [dataSource]="dataSource" matSort>
                    <!-- ID Column -->
                    <ng-container matColumnDef="Nombre" sticky>
                      <th
                        class="text-left"
                        mat-header-cell
                        *matHeaderCellDef
                        mat-sort-header
                        style="width: 20%"
                      >
                        {{ "calendario.nombre" | translate }}
                      </th>
                      <td mat-cell *matCellDef="let row">{{ row.Nombre }}</td>
                    </ng-container>
                    <!-- Progress Column -->
                    <ng-container matColumnDef="Descripcion">
                      <th
                        mat-header-cell
                        *matHeaderCellDef
                        mat-sort-header
                        style="width: 80%"
                      >
                        {{ "GLOBAL.descripcion" | translate }}
                      </th>
                    </ng-container>

                    <ng-container matColumnDef="FechaInicio">
                      <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 20%;">
                        {{'calendario.fecha_inicio' | translate}} </th>
                      <td mat-cell *matCellDef="let row"> {{row.FechaInicio}} </td>
                    </ng-container>

                    <ng-container matColumnDef="FechaFin">
                      <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 20%;">
                        {{'calendario.fecha_fin' | translate}} </th>
                      <td mat-cell *matCellDef="let row"> {{row.FechaFin}} </td>
                    </ng-container>

                    <ng-container matColumnDef="Activo">
                      <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 20%;"> 
                        {{'calendario.estado' | translate}} </th>
                      <td mat-cell *matCellDef="let row"> {{row.Activo ? 'Activo' : 'Inactivo'}} </td>
                    </ng-container>

                    <ng-container matColumnDef="Acciones">
                      <th mat-header-cell *matHeaderCellDef mat-sort-header>
                        {{ "GLOBAL.acciones" | translate }}
                      </th>
                      <td mat-cell *matCellDef="let row">
                        <button
                          mat-icon-button
                          color="accent"
                          (click)="
                            onAction({ action: 'view', data: row }, null)
                          "
                        >
                          <mat-icon
                            aria-hidden="false"
                            title="{{
                              'calendario.tooltip_detalle_proceso' | translate
                            }}"
                            fontIcon="search"
                          >
                          </mat-icon>
                        </button></td
                    ></ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                    <tr
                      mat-row
                      *matRowDef="let row; columns: displayedColumns"
                    ></tr>

                    <!-- Row shown when there is no matching data. -->
                    <tr class="mat-row" *matNoDataRow>
                      <td class="mat-cell" colspan="4">
                        {{ "calendario.sin_procesos" | translate }}
                      </td>
                    </tr>
                  </table>
                </div>
              </mat-card-content>
            </mat-card>
          </mat-tab>

          <mat-tab label="{{ 'calendario.actividades' | translate }}">
            <mat-card>
              <mat-card-content>
                <mat-accordion>
                  <mat-expansion-panel
                    *ngFor="let process of processes; index as i"
                  >
                    <mat-expansion-panel-header>
                      <mat-panel-title>
                        {{ process.Nombre }}
                      </mat-panel-title>
                    </mat-expansion-panel-header>

                    <!-- Aquí va el contenido de actividades -->

                    <mat-card>
                      <mat-card-content>
                        <mat-form-field style="width: 100%">
                          <mat-label>{{
                            "GLOBAL.buscar" | translate
                          }}</mat-label>
                          <input
                            matInput
                            (keyup)="
                              applyFilterActividades(
                                $event,
                                process.actividades,
                                i
                              )
                            "
                            placeholder="{{ 'GLOBAL.buscar' | translate }}"
                            #inputActividades
                          />
                          <mat-icon class="icon-search" matPrefix
                            >search</mat-icon
                          >
                        </mat-form-field>

                        <div class="mat-elevation-z8">
                          <table
                            mat-table
                            [dataSource]="process.actividades"
                            matSort
                          >
                            <!-- ID Column -->
                            <ng-container matColumnDef="Nombre">
                              <th
                                mat-header-cell
                                *matHeaderCellDef
                                mat-sort-header
                                style="width: 20%"
                              >
                                {{ "calendario.nombre" | translate }}
                              </th>
                              <td mat-cell *matCellDef="let row">
                                {{ row.Nombre }}
                              </td>
                            </ng-container>

                            <!-- Progress Column -->
                            <ng-container matColumnDef="Descripcion">
                              <th
                                mat-header-cell
                                *matHeaderCellDef
                                mat-sort-header
                                style="width: 20%"
                              >
                                {{ "GLOBAL.descripcion" | translate }}
                              </th>

                              <td mat-cell *matCellDef="let row">
                                {{ row.Descripcion }}
                              </td>
                            </ng-container>

                            <ng-container matColumnDef="FechaInicio">
                              <th
                                mat-header-cell
                                *matHeaderCellDef
                                mat-sort-header
                                style="width: 20%"
                              >
                                {{ "calendario.fecha_inicio" | translate }}
                              </th>
                              <td mat-cell *matCellDef="let row">
                                {{ row.FechaInicio }}
                              </td>
                            </ng-container>

                            <ng-container matColumnDef="FechaFin">
                              <th
                                mat-header-cell
                                *matHeaderCellDef
                                mat-sort-header
                                style="width: 20%"
                              >
                                {{ "calendario.fecha_fin" | translate }}
                              </th>
                              <td mat-cell *matCellDef="let row">
                                {{ row.FechaFin }}
                              </td>
                            </ng-container>

                            <ng-container matColumnDef="Activo">
                              <th
                                mat-header-cell
                                *matHeaderCellDef
                                mat-sort-header
                                style="width: 20%"
                              >
                                {{ "calendario.estado" | translate }}
                              </th>
                              <td mat-cell *matCellDef="let row">
                                {{ row.Activo }}
                              </td>
                            </ng-container>

                            <ng-container matColumnDef="Acciones">
                              <th
                                mat-header-cell
                                *matHeaderCellDef
                                mat-sort-header
                              >
                                {{ "GLOBAL.acciones" | translate }}
                              </th>
                              <td mat-cell *matCellDef="let row">
                                <div style="display: flex;">
                                  <button
                                  (click)="
                                    onAction(
                                      { action: 'edit', data: row },
                                      process.actividades
                                    )
                                  "
                                  mat-icon-button
                                  color="accent"
                                >
                                  <mat-icon
                                    aria-hidden="false"
                                    title="{{
                                      'calendario.tooltip_editar_actividad'
                                        | translate
                                    }}"
                                    fontIcon="edit_outline"
                                  >
                                  </mat-icon>
                                </button>
                                <button
                                  mat-icon-button
                                  color="warn"
                                  (click)="onAction( {action: 'disable', }, process ) "
                                >
                                  <mat-icon
                                    aria-hidden="false"
                                    title="{{
                                      'calendario.tooltip_estado_actividad'
                                        | translate
                                    }}"
                                    fontIcon="lock"
                                  >
                                  </mat-icon>
                                </button>
                                </div>
                                
                              </td>
                            </ng-container>

                            <tr
                              mat-header-row
                              *matHeaderRowDef="displayedColumnsActividades"
                            ></tr>
                            <tr
                              mat-row
                              *matRowDef="
                                let row;
                                columns: displayedColumnsActividades
                              "
                            ></tr>

                            <!-- Row shown when there is no matching data. -->
                            <tr class="mat-row" *matNoDataRow>
                              <td class="mat-cell" colspan="4">
                                No data matching the filter "{{
                                  inputActividades.value
                                }}"
                              </td>
                            </tr>
                          </table>
                        </div>
                      </mat-card-content>
                    </mat-card>
                  </mat-expansion-panel>
                </mat-accordion>
              </mat-card-content>
            </mat-card>
          </mat-tab>
        </mat-tab-group>
      </mat-card-content>
    </mat-card>
  </mat-card-content>
  <mat-card-actions> </mat-card-actions>
</mat-card>
